# 요구사항 분석 및 설계 결정

## A. 요구사항 요약(현재 확정된 것만)
- 과제는 **수강신청 시스템**을 구현한다.
- 기술 스택은 **Python + FastAPI**, DB는 **SQLite**, 실행 환경은 **venv**를 사용한다.
- 제출물 구조에 맞춰 문서(`README.md`, `docs/REQUIREMENTS.md`, `docs/API.md`)와 프롬프트 이력(`prompts/`)을 포함한다.

## B. 모호/누락 항목 리스트(결정 필요)
- 사용자 인증/권한(학생/관리자) 범위
- 강의/분반 데이터의 생성 방식(관리자 API 필요 여부)
- 수강신청 기간(오픈/마감) 정책
- 정원 초과 시 대기열(Waitlist) 운영 여부
- 시간표 충돌/중복 수강/최대학점 제한의 적용 여부
- 수강신청 취소 시 이력 보존 정책
- 평가/성적/수강료 등 부가 기능

## C. 내가 채택한 가정/정책(선택지와 이유 포함)
- 인증/권한: **미적용**. 요청 본문에 `student_id`를 포함한다.
  - 이유: 요구사항에 명시되지 않았고 코딩테스트 범위를 단순화하기 위함.
- 데이터 생성: **학생/과목/분반 생성용 API 제공**.
  - 이유: 외부 데이터 소스가 없으므로 테스트 가능성을 확보.
- 정원 정책: **정원 초과 시 즉시 거절(409)**, 대기열은 **미구현**.
  - 이유: 핵심 로직에 집중하고 범위를 최소화.
- 중복 수강: **동일 학기 내 동일 과목 중복 수강 금지**.
  - 이유: 일반적인 학사 정책이며 데이터 정합성 확보.
- 시간표 충돌: **동일 학기 내 시간 겹침 금지**.
  - 이유: 현실적인 제약이며 최소한의 검증 로직으로 구현 가능.
- 최대 학점: **학생별 최대 학점 제한 적용(기본 18학점)**.
  - 이유: 일반 정책에 부합하고 단순 합계 검증으로 구현 가능.
- 취소 정책: **수강신청 취소 시 enrollment 삭제(이력 미보존)**.
  - 이유: 감사/이력 기능은 범위 밖으로 두고 단순화.
- 동시성 처리: **SQLite 트랜잭션(즉시 잠금)으로 정원 경쟁 상태 해결**.
  - 이유: 동시 신청 시 정원 초과를 방지하기 위한 최소한의 안정성 확보.

## D. 주요 데이터 모델/도메인 용어 정의
- Student
  - `id`, `name`, `max_credits`
- Term
  - `id`, `name`, `start_date`, `end_date`
- Course
  - `id`, `code`, `name`, `credits`
- Section
  - `id`, `course_id`, `term_id`, `section_no`, `capacity`
  - `schedule`: 요일/시작/종료 시간 목록
- Enrollment
  - `id`, `student_id`, `section_id`, `created_at`

## E. 핵심 유즈케이스/예외 케이스(경합 조건 포함)
- 학생이 분반을 조회하고 수강신청한다.
  - 예외: 정원 초과(409), 중복 수강(409), 시간표 충돌(409), 학점 초과(409).
- 학생이 수강신청을 취소한다.
  - 예외: 이미 취소/없는 신청(404).
- 동시성: 여러 학생이 마지막 정원을 동시에 신청.
  - 정책: 트랜잭션 내에서 정원 검증 후 삽입, 실패 시 409 반환.

## F. 구현 범위(스코프)와 의도적으로 제외한 범위
- 포함 범위
  - 과목/분반/학생 생성 API
  - 분반 조회
  - 수강신청/취소
  - 정원/중복/시간표/학점 검증
- 제외 범위
  - 인증/권한, 대기열, 선수과목, 수강료/결제, 성적/평가, 알림, 감사/이력

## G. 에러/예외 정의
- `STUDENT_NOT_FOUND`
- `SECTION_NOT_FOUND`
- `ENROLLMENT_NOT_FOUND`
- `COURSE_CODE_CONFLICT`
- `CAPACITY_FULL`
- `DUPLICATE_COURSE`
- `TIME_CONFLICT`
- `CREDIT_LIMIT_EXCEEDED`
- `VALIDATION_ERROR`

## H. 테스트 시나리오
1. 정상 흐름: 학생/과목/분반 생성 후 수강신청 성공.
2. 정원 초과: 정원 1인 분반에 2명 신청 → 두 번째는 409(`CAPACITY_FULL`).
3. 중복 수강: 동일 학기 동일 과목의 다른 분반 신청 → 409(`DUPLICATE_COURSE`).
4. 시간표 충돌: 같은 요일/시간이 겹치는 분반 신청 → 409(`TIME_CONFLICT`).
5. 학점 초과: 최대학점 3인 학생이 3학점+3학점 신청 → 409(`CREDIT_LIMIT_EXCEEDED`).
6. 취소 후 재신청: 수강취소 후 동일 분반 재신청 성공.
7. 동시성: 마지막 정원에 대해 동시 신청 시 한 건만 성공.
